# How to Run the 1D Bio-Climatic Coupling on Your Own Computer?

To run the coupling on your local machine, simply download this folder along with the `Ktables` and `ciatables` folders. Then, browse through the different files in this folder and update the file paths to match your computer's structure. The code will then be ready to use.

## Table of Contents
- [1. Biology-related files](#1-biology-related-files)
- [2. Useful functions for coupling (physics)](#2-useful-functions-for-coupling-physics)
  - [2.1. EXO_K_wo_ocean.py](#21-exo_k_wo_oceanpy)
  - [2.2. Functions2.py](#22-functions2py)
  - [2.3. Main_evolution_function_RK.py](#23-main_evolution_function_rkpy)
  - [2.4. Photochem.py](#24-photochempy)
  - [2.5. Interface_atmosphere_ocean.py](#25-interface_atmosphere_oceanpy)
- [3. Data grids](#3-data-grids)
- [4. Coupling Jupyter notebook: BioClim_coupling.ipynb](#4-coupling-jupyter-notebook-bioclim_couplingipynb)
- [5. Coupling with biology restart: BioClim_coupling_w_restart_bio.ipynb](#5-coupling-with-biology-restart-bioclim_coupling_w_restart_bioipynb)
- [6. Test notebook for Exok: EXO_K_with_ocean.ipynb](#6-test-notebook-for-exok-exo_k_with_oceanipynb)
- [7. Plotting notebooks](#7-plotting-notebooks)

---

## 1. Biology-related files

These files were mostly written by Boris Sauterey. They simulate the thermodynamic evolution of biology.  
**THEY SHOULD NOT BE MODIFIED.**

Files:
- `Acetogens1.py`, `Bio.py`, `Bio_model.py`, `Bio_model_parameter.py`, `Constants.py`, `Functions.py`, `Methanogens.py`

---

## 2. Useful functions for coupling (physics)

### 2.1. `EXO_K_wo_ocean.py`

This file contains the functions used to define an atmosphere using *Exok*. You can adjust atmospheric parameters such as gravity, stellar temperature, etc., between **lines 26 and 32** of the code.  
These parameters are described in detail in the [*Exok* documentation](https://perso.astrophy.u-bordeaux.fr/~jleconte/exo_k-doc/practical_guide_to_atm.html).  
The code imports the `corrk` and `cia` tables and extends them over the same spectral range, then reduces their resolution.  
**The only lines to modify are lines 122 and 123**, which define the paths to the `Ktables` and `ciatables` directories.

### 2.2. `Functions2.py`

This file contains physical functions used to calculate:
- Altitude from pressure and temperature
- Atmospheric matter quantity
- Pressure profile

See function comments for more details.  
**NOTHING SHOULD BE CHANGED.**

### 2.3. `Main_evolution_function_RK.py`

Defines the `system_evolution_RK` function, which simultaneously evolves ocean and atmosphere compositions due to biological activity, using an adaptive timestep solver with the **LSODA** method.  
**NOTHING SHOULD BE CHANGED.**

### 2.4. `Photochem.py`

Interpolates the data grid `Grid_no_header.csv` to return CH₄ and H₂ fluxes in the atmosphere, based on the work of **Zahnle and Kasting**.  
**NOTHING SHOULD BE CHANGED.**

### 2.5. `Interface_atmosphere_ocean.py`

Computes interface fluxes using the **stagnant boundary layer model** (Karecha et al., 2005).  
**NOTHING SHOULD BE CHANGED.**

---

## 3. Data grids

- `Grid_no_header.csv`: Used to compute CH₄ and H₂ fluxes in the atmosphere
- `Grid_values_ini.csv`: Interpolated to obtain initial concentrations of cells and methanogens in the ocean

**THESE FILES SHOULD NOT BE MODIFIED.**

---

## 4. Coupling Jupyter notebook: `BioClim_coupling.ipynb`

This notebook loads the relevant `.py` files and simulates the bio-climatic coupling. It saves a file that tracks the temporal evolution of:
- Methanogen and chemical species concentrations in the ocean
- Atmospheric matter quantities
- Pressures and fluxes at the interface and in the atmosphere

To use it:  
✅ **Make sure the path to `Grid_values_ini.csv` is correct**.  
Nothing else needs to be changed.

It also plots the temporal evolution of all quantities.

---

## 5. Coupling with biology restart: `BioClim_coupling_w_restart_bio.ipynb`

Once the ocean is frozen, biological activity stops. Greenhouse warming from photodissociation can eventually reheat the ocean.  
This notebook (similar to the previous one) simulates the **resumption of biological activity** during this second warming phase.  

---

## 6. Test notebook for Exok: `EXO_K_with_ocean.ipynb`

Used to simulate an atmosphere that includes **water vapor**.  
⚠️ Not used for coupling directly.  
Temperatures are not consistent with 3D models, so a **dry atmosphere** is preferred for coupling.

---

## 7. Plotting notebooks

- `Plot_coupling.ipynb`: Plots the coupling results generated by `BioClim_coupling.ipynb`
- `Plot_coupling_GEL_variable.ipynb`, `Plot_coupling_r_variable.ipynb`, `Plot_coupling_niter_variable.ipynb`: Plot coupling evolution depending on three parameters:
  - `GEL`: global equivalent layer
  - `r = Vcell / Vocean`: cell-to-ocean volume ratio
  - `niter`: number of climate model calls during the coupling

These notebooks show means and standard deviations for simulations with different parameter sets.

⚠️ **The files used by these notebooks can only becreated on a server**, as it is time consumming to create them.  
For more details, refer to the [corresponding section](../Coupling_on_server).
